-- Tabla de unidades de medida
CREATE TABLE MEASUREMENT_UNITS (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    CODE VARCHAR2(10) NOT NULL,
    NAME VARCHAR2(50) NOT NULL,
    SYMBOL VARCHAR2(10) NOT NULL,
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_MEASUREMENT_UNITS PRIMARY KEY (ID),
    CONSTRAINT UK_MEASUREMENT_UNITS_CODE UNIQUE (CODE)
);

-- Tabla de atributos (ej: color, talla, etc)
CREATE TABLE ATTRIBUTES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    CODE VARCHAR2(50) NOT NULL,
    NAME VARCHAR2(100) NOT NULL,
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_ATTRIBUTES PRIMARY KEY (ID),
    CONSTRAINT UK_ATTRIBUTES_CODE UNIQUE (CODE)
);

-- Tabla de valores de atributos (ej: rojo, XL, etc)
CREATE TABLE ATTRIBUTE_VALUES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    ATTRIBUTE_ID NUMBER NOT NULL,
    CODE VARCHAR2(50) NOT NULL,
    VALUE VARCHAR2(100) NOT NULL,
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_ATTRIBUTE_VALUES PRIMARY KEY (ID),
    CONSTRAINT FK_ATTRIBUTE_VALUES_ATTRIBUTE FOREIGN KEY (ATTRIBUTE_ID) REFERENCES ATTRIBUTES(ID),
    CONSTRAINT UK_ATTRIBUTE_VALUES_CODE UNIQUE (ATTRIBUTE_ID, CODE)
);

-- Modificar la tabla de productos
ALTER TABLE PRODUCTS
ADD MEASUREMENT_UNIT_ID NUMBER
ADD CONSTRAINT FK_PRODUCTS_MEASUREMENT_UNIT FOREIGN KEY (MEASUREMENT_UNIT_ID) REFERENCES MEASUREMENT_UNITS(ID);

-- Tabla de variantes de productos
CREATE TABLE PRODUCT_VARIANTS (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    PRODUCT_ID NUMBER NOT NULL,
    SKU VARCHAR2(50) NOT NULL,
    PRICE NUMBER(10,2) NOT NULL,
    STOCK_QUANTITY NUMBER NOT NULL,
    WEIGHT NUMBER(10,2),
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_PRODUCT_VARIANTS PRIMARY KEY (ID),
    CONSTRAINT FK_PRODUCT_VARIANTS_PRODUCT FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(ID),
    CONSTRAINT UK_PRODUCT_VARIANTS_SKU UNIQUE (SKU)
);

-- Tabla de relación entre variantes y valores de atributos
CREATE TABLE PRODUCT_VARIANT_ATTRIBUTES (
    VARIANT_ID NUMBER NOT NULL,
    ATTRIBUTE_VALUE_ID NUMBER NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_PRODUCT_VARIANT_ATTRIBUTES PRIMARY KEY (VARIANT_ID, ATTRIBUTE_VALUE_ID),
    CONSTRAINT FK_PVA_VARIANT FOREIGN KEY (VARIANT_ID) REFERENCES PRODUCT_VARIANTS(ID),
    CONSTRAINT FK_PVA_ATTRIBUTE_VALUE FOREIGN KEY (ATTRIBUTE_VALUE_ID) REFERENCES ATTRIBUTE_VALUES(ID)
);

-- Eliminar columnas que ahora están en las variantes
ALTER TABLE PRODUCTS
DROP COLUMN SKU
DROP COLUMN PRICE
DROP COLUMN STOCK_QUANTITY
DROP COLUMN WEIGHT;

-- Datos de ejemplo para unidades de medida
INSERT INTO MEASUREMENT_UNITS (CODE, NAME, SYMBOL, CREATED_BY, UPDATED_BY)
VALUES ('UNIT', 'Unidades', 'ud', 'SYSTEM', 'SYSTEM');

INSERT INTO MEASUREMENT_UNITS (CODE, NAME, SYMBOL, CREATED_BY, UPDATED_BY)
VALUES ('KG', 'Kilogramos', 'kg', 'SYSTEM', 'SYSTEM');

-- Datos de ejemplo para atributos
INSERT INTO ATTRIBUTES (CODE, NAME, CREATED_BY, UPDATED_BY)
VALUES ('COLOR', 'Color', 'SYSTEM', 'SYSTEM');

INSERT INTO ATTRIBUTES (CODE, NAME, CREATED_BY, UPDATED_BY)
VALUES ('SIZE', 'Talla', 'SYSTEM', 'SYSTEM');

-- Datos de ejemplo para valores de atributos
INSERT INTO ATTRIBUTE_VALUES (ATTRIBUTE_ID, CODE, VALUE, CREATED_BY, UPDATED_BY)
SELECT ID, 'RED', 'Rojo', 'SYSTEM', 'SYSTEM'
FROM ATTRIBUTES WHERE CODE = 'COLOR';

INSERT INTO ATTRIBUTE_VALUES (ATTRIBUTE_ID, CODE, VALUE, CREATED_BY, UPDATED_BY)
SELECT ID, 'BLUE', 'Azul', 'SYSTEM', 'SYSTEM'
FROM ATTRIBUTES WHERE CODE = 'COLOR';

INSERT INTO ATTRIBUTE_VALUES (ATTRIBUTE_ID, CODE, VALUE, CREATED_BY, UPDATED_BY)
SELECT ID, 'S', 'Small', 'SYSTEM', 'SYSTEM'
FROM ATTRIBUTES WHERE CODE = 'SIZE';

INSERT INTO ATTRIBUTE_VALUES (ATTRIBUTE_ID, CODE, VALUE, CREATED_BY, UPDATED_BY)
SELECT ID, 'M', 'Medium', 'SYSTEM', 'SYSTEM'
FROM ATTRIBUTES WHERE CODE = 'SIZE';

INSERT INTO ATTRIBUTE_VALUES (ATTRIBUTE_ID, CODE, VALUE, CREATED_BY, UPDATED_BY)
SELECT ID, 'L', 'Large', 'SYSTEM', 'SYSTEM'
FROM ATTRIBUTES WHERE CODE = 'SIZE';

COMMIT;
