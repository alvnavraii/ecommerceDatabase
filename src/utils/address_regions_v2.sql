-- Tabla de países
CREATE TABLE COUNTRIES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    CODE VARCHAR2(2) NOT NULL,
    NAME VARCHAR2(100) NOT NULL,
    SLUG VARCHAR2(100) NOT NULL,  -- Siguiendo el patrón de categorías para URLs amigables
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_COUNTRIES PRIMARY KEY (ID),
    CONSTRAINT UK_COUNTRIES_CODE UNIQUE (CODE),
    CONSTRAINT UK_COUNTRIES_SLUG UNIQUE (SLUG)
);

-- Índice para ordenamiento por ID (patrón establecido)
CREATE INDEX IDX_COUNTRIES_ID ON COUNTRIES(ID ASC);

-- Tabla de comunidades autónomas
CREATE TABLE AUTONOMOUS_COMMUNITIES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    COUNTRY_ID NUMBER NOT NULL,
    CODE VARCHAR2(4) NOT NULL,
    NAME VARCHAR2(100) NOT NULL,
    SLUG VARCHAR2(100) NOT NULL,
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_AUTONOMOUS_COMMUNITIES PRIMARY KEY (ID),
    CONSTRAINT FK_AC_COUNTRY FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRIES(ID),
    CONSTRAINT UK_AC_CODE UNIQUE (CODE),
    CONSTRAINT UK_AC_SLUG UNIQUE (SLUG)
);

CREATE INDEX IDX_AC_ID ON AUTONOMOUS_COMMUNITIES(ID ASC);
CREATE INDEX IDX_AC_COUNTRY ON AUTONOMOUS_COMMUNITIES(COUNTRY_ID ASC);

-- Tabla de provincias
CREATE TABLE PROVINCES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    AUTONOMOUS_COMMUNITY_ID NUMBER NOT NULL,
    CODE VARCHAR2(2) NOT NULL,
    NAME VARCHAR2(100) NOT NULL,
    SLUG VARCHAR2(100) NOT NULL,
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_PROVINCES PRIMARY KEY (ID),
    CONSTRAINT FK_PROVINCES_AC FOREIGN KEY (AUTONOMOUS_COMMUNITY_ID) REFERENCES AUTONOMOUS_COMMUNITIES(ID),
    CONSTRAINT UK_PROVINCES_CODE UNIQUE (CODE),
    CONSTRAINT UK_PROVINCES_SLUG UNIQUE (SLUG)
);

CREATE INDEX IDX_PROVINCES_ID ON PROVINCES(ID ASC);
CREATE INDEX IDX_PROVINCES_AC ON PROVINCES(AUTONOMOUS_COMMUNITY_ID ASC);

-- Tabla de municipios
CREATE TABLE MUNICIPALITIES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    PROVINCE_ID NUMBER NOT NULL,
    CODE VARCHAR2(5) NOT NULL,
    NAME VARCHAR2(100) NOT NULL,
    SLUG VARCHAR2(100) NOT NULL,
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    UPDATED_BY VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_MUNICIPALITIES PRIMARY KEY (ID),
    CONSTRAINT FK_MUNICIPALITIES_PROVINCE FOREIGN KEY (PROVINCE_ID) REFERENCES PROVINCES(ID),
    CONSTRAINT UK_MUNICIPALITIES_CODE UNIQUE (CODE),
    CONSTRAINT UK_MUNICIPALITIES_SLUG UNIQUE (SLUG)
);

CREATE INDEX IDX_MUNICIPALITIES_ID ON MUNICIPALITIES(ID ASC);
CREATE INDEX IDX_MUNICIPALITIES_PROVINCE ON MUNICIPALITIES(PROVINCE_ID ASC);

-- Datos de ejemplo para España
INSERT INTO COUNTRIES (CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
VALUES ('ES', 'España', 'espana', 'SYSTEM', 'SYSTEM');

-- Comunidad de Madrid
INSERT INTO AUTONOMOUS_COMMUNITIES (COUNTRY_ID, CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
SELECT ID, 'MAD', 'Comunidad de Madrid', 'comunidad-de-madrid', 'SYSTEM', 'SYSTEM'
FROM COUNTRIES WHERE CODE = 'ES';

-- Provincia de Madrid
INSERT INTO PROVINCES (AUTONOMOUS_COMMUNITY_ID, CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
SELECT ID, '28', 'Madrid', 'madrid', 'SYSTEM', 'SYSTEM'
FROM AUTONOMOUS_COMMUNITIES WHERE CODE = 'MAD';

-- Municipios de Madrid
INSERT INTO MUNICIPALITIES (PROVINCE_ID, CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
SELECT p.ID, '28079', 'Madrid', 'madrid', 'SYSTEM', 'SYSTEM'
FROM PROVINCES p WHERE p.CODE = '28';

INSERT INTO MUNICIPALITIES (PROVINCE_ID, CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
SELECT p.ID, '28006', 'Alcalá de Henares', 'alcala-de-henares', 'SYSTEM', 'SYSTEM'
FROM PROVINCES p WHERE p.CODE = '28';

-- Cataluña
INSERT INTO AUTONOMOUS_COMMUNITIES (COUNTRY_ID, CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
SELECT ID, 'CAT', 'Cataluña', 'cataluna', 'SYSTEM', 'SYSTEM'
FROM COUNTRIES WHERE CODE = 'ES';

-- Provincia de Barcelona
INSERT INTO PROVINCES (AUTONOMOUS_COMMUNITY_ID, CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
SELECT ID, '08', 'Barcelona', 'barcelona', 'SYSTEM', 'SYSTEM'
FROM AUTONOMOUS_COMMUNITIES WHERE CODE = 'CAT';

-- Municipios de Barcelona
INSERT INTO MUNICIPALITIES (PROVINCE_ID, CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
SELECT p.ID, '08019', 'Barcelona', 'barcelona', 'SYSTEM', 'SYSTEM'
FROM PROVINCES p WHERE p.CODE = '08';

INSERT INTO MUNICIPALITIES (PROVINCE_ID, CODE, NAME, SLUG, CREATED_BY, UPDATED_BY)
SELECT p.ID, '08101', 'Hospitalet de Llobregat', 'hospitalet-de-llobregat', 'SYSTEM', 'SYSTEM'
FROM PROVINCES p WHERE p.CODE = '08';

COMMIT;
